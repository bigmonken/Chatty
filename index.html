<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Chatboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC79Q4N4bchGt_kwcu5IKY_4AfvAcDpleI",
      authDomain: "chatty-a1995.firebaseapp.com",
      databaseURL: "https://chatty-a1995-default-rtdb.firebaseio.com",
      projectId: "chatty-a1995",
      storageBucket: "chatty-a1995.firebasestorage.app",
      messagingSenderId: "1056089132464",
      appId: "1:1056089132464:web:34952c387d04932f245a75"
    };


        const ADMIN_USERS = {
            "logan": "9867",
            "aiden": "345657",
            "ethan": "134352"
            // Add more users like: "username": "password"
        };
        
        // Initialize Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        const { useState, useEffect, useRef, createElement: e } = React;

        function MessageCircleIcon({ className = "w-6 h-6" }) {
            return e('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: "24",
                height: "24",
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeLinejoin: "round",
                className
            }, 
                e('path', { d: "M7.9 20A9 9 0 1 0 4 16.1L2 22Z" })
            );
        }

        function SendIcon({ className = "w-4 h-4" }) {
            return e('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: "24",
                height: "24",
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeLinejoin: "round",
                className
            },
                e('path', { d: "m22 2-7 20-4-9-9-4Z" }),
                e('path', { d: "M22 2 11 13" })
            );
        }

        function AlertCircleIcon({ className = "w-4 h-4" }) {
            return e('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: "24",
                height: "24",
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeLinejoin: "round",
                className
            },
                e('circle', { cx: "12", cy: "12", r: "10" }),
                e('line', { x1: "12", y1: "8", x2: "12", y2: "12" }),
                e('line', { x1: "12", y1: "16", x2: "12.01", y2: "16" })
            );
        }

        function TrashIcon({ className = "w-4 h-4" }) {
            return e('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: "24",
                height: "24",
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeLinejoin: "round",
                className
            },
                e('path', { d: "M3 6h18" }),
                e('path', { d: "M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" }),
                e('path', { d: "M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" })
            );
        }

        function LogInIcon({ className = "w-4 h-4" }) {
            return e('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: "24",
                height: "24",
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeLinejoin: "round",
                className
            },
                e('path', { d: "M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" }),
                e('polyline', { points: "10 17 15 12 10 7" }),
                e('line', { x1: "15", y1: "12", x2: "3", y2: "12" })
            );
        }

        function LogOutIcon({ className = "w-4 h-4" }) {
            return e('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: "24",
                height: "24",
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeLinejoin: "round",
                className
            },
                e('path', { d: "M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" }),
                e('polyline', { points: "16 17 21 12 16 7" }),
                e('line', { x1: "21", y1: "12", x2: "9", y2: "12" })
            );
        }

        function MoonIcon({ className = "w-4 h-4" }) {
            return e('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: "24",
                height: "24",
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeLinejoin: "round",
                className
            },
                e('path', { d: "M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" })
            );
        }

        function SunIcon({ className = "w-4 h-4" }) {
            return e('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: "24",
                height: "24",
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeLinejoin: "round",
                className
            },
                e('circle', { cx: "12", cy: "12", r: "4" }),
                e('path', { d: "M12 2v2" }),
                e('path', { d: "M12 20v2" }),
                e('path', { d: "m4.93 4.93 1.41 1.41" }),
                e('path', { d: "m17.66 17.66 1.41 1.41" }),
                e('path', { d: "M2 12h2" }),
                e('path', { d: "M20 12h2" }),
                e('path', { d: "m6.34 17.66-1.41 1.41" }),
                e('path', { d: "m19.07 4.93-1.41 1.41" })
            );
        }

        function GlobalChatboard() {
            const [messages, setMessages] = useState([]);
            const [username, setUsername] = useState('');
            const [message, setMessage] = useState('');
            const [isLoading, setIsLoading] = useState(true);
            const [error, setError] = useState('');
            const [showClearConfirm, setShowClearConfirm] = useState(false);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [loginUsername, setLoginUsername] = useState('');
            const [loginPassword, setLoginPassword] = useState('');
            const [loginError, setLoginError] = useState('');
            const [darkMode, setDarkMode] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            useEffect(() => {
                if (!database) {
                    setError('Firebase not configured. Please add your Firebase config.');
                    setIsLoading(false);
                    return;
                }

                // Check if user is already logged in
                const userSession = sessionStorage.getItem('chatboard_user');
                const savedUsername = sessionStorage.getItem('chatboard_username');
                if (userSession && savedUsername) {
                    setIsLoggedIn(true);
                    setUsername(savedUsername);
                }

                // Load dark mode preference
                const savedDarkMode = localStorage.getItem('chatboard_darkmode');
                if (savedDarkMode === 'true') {
                    setDarkMode(true);
                }

                setIsLoading(false);
            }, []);

            useEffect(() => {
                if (!database || !isLoggedIn) return;

                // Listen for messages only when logged in
                const messagesRef = database.ref('messages');
                
                messagesRef.orderByChild('timestamp').limitToLast(100).on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const messageList = Object.keys(data).map(key => ({
                            id: key,
                            ...data[key]
                        })).sort((a, b) => a.timestamp - b.timestamp);
                        setMessages(messageList);
                    } else {
                        setMessages([]);
                    }
                });

                // Cleanup listener
                return () => messagesRef.off();
            }, [isLoggedIn]);

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const handleUsernameSubmit = () => {
                if (username.trim()) {
                    localStorage.setItem('chatboard_username', username.trim());
                    setError('');
                }
            };

            const handleMessageSubmit = async () => {
                if (!database) {
                    setError('Firebase not configured');
                    return;
                }

                if (!username.trim()) {
                    setError('Please set a username first');
                    return;
                }
                
                if (!message.trim()) return;

                const newMessage = {
                    username: username.trim(),
                    text: message.trim(),
                    timestamp: Date.now()
                };

                try {
                    await database.ref('messages').push(newMessage);
                    setMessage('');
                    setError('');
                } catch (err) {
                    setError('Failed to send message: ' + err.message);
                    console.error(err);
                }
            };

            const handleLogin = () => {
                const trimmedUsername = loginUsername.trim();
                const trimmedPassword = loginPassword.trim();

                if (ADMIN_USERS[trimmedUsername] === trimmedPassword) {
                    setIsLoggedIn(true);
                    setUsername(trimmedUsername);
                    sessionStorage.setItem('chatboard_user', 'true');
                    sessionStorage.setItem('chatboard_username', trimmedUsername);
                    localStorage.setItem('chatboard_username', trimmedUsername);
                    setLoginError('');
                    setLoginUsername('');
                    setLoginPassword('');
                } else {
                    setLoginError('Invalid username or password');
                }
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setUsername('');
                sessionStorage.removeItem('chatboard_user');
                sessionStorage.removeItem('chatboard_username');
            };

            const toggleDarkMode = () => {
                const newMode = !darkMode;
                setDarkMode(newMode);
                localStorage.setItem('chatboard_darkmode', newMode.toString());
            };

            const formatTime = (timestamp) => {
                const date = new Date(timestamp);
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            };

            if (isLoading) {
                return e('div', { className: `flex items-center justify-center min-h-screen ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-50 to-indigo-100'}` },
                    e('div', { className: 'text-center' },
                        e(MessageCircleIcon, { className: `w-12 h-12 ${darkMode ? 'text-indigo-400' : 'text-indigo-600'} animate-pulse mx-auto mb-4` }),
                        e('p', { className: darkMode ? 'text-gray-300' : 'text-gray-600' }, 'Loading chatboard...')
                    )
                );
            }

            // Show login screen if not logged in
            if (!isLoggedIn) {
                return e('div', { className: `flex items-center justify-center min-h-screen ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-50 to-indigo-100'}` },
                    e('div', { className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg p-8 max-w-md w-full shadow-xl mx-4 relative` },
                        e('button', {
                            onClick: toggleDarkMode,
                            className: `absolute top-4 right-4 p-2 rounded-lg ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'} transition-colors`,
                            title: darkMode ? 'Light mode' : 'Dark mode'
                        },
                            darkMode ? e(SunIcon, { className: 'w-5 h-5 text-yellow-400' }) : e(MoonIcon, { className: 'w-5 h-5 text-gray-700' })
                        ),
                        e('div', { className: 'text-center mb-6' },
                            e(MessageCircleIcon, { className: `w-16 h-16 ${darkMode ? 'text-indigo-400' : 'text-indigo-600'} mx-auto mb-4` }),
                            e('h1', { className: `text-3xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'} mb-2` }, 'Global Chatboard'),
                            e('p', { className: darkMode ? 'text-gray-400' : 'text-gray-600' }, 'Please login to continue')
                        ),
                        e('div', { className: 'space-y-4' },
                            e('div', null,
                                e('label', { className: `block text-sm font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-1` }, 'Username'),
                                e('input', {
                                    type: 'text',
                                    value: loginUsername,
                                    onChange: (ev) => setLoginUsername(ev.target.value),
                                    onKeyDown: (ev) => ev.key === 'Enter' && handleLogin(),
                                    className: `w-full px-4 py-2 border ${darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900'} rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`,
                                    placeholder: 'Enter username'
                                })
                            ),
                            e('div', null,
                                e('label', { className: `block text-sm font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-1` }, 'Password'),
                                e('input', {
                                    type: 'password',
                                    value: loginPassword,
                                    onChange: (ev) => setLoginPassword(ev.target.value),
                                    onKeyDown: (ev) => ev.key === 'Enter' && handleLogin(),
                                    className: `w-full px-4 py-2 border ${darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900'} rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`,
                                    placeholder: 'Enter password'
                                })
                            ),
                            loginError && e('div', { className: `${darkMode ? 'text-red-400' : 'text-red-600'} text-sm flex items-center gap-2` },
                                e(AlertCircleIcon, { className: 'w-4 h-4' }),
                                loginError
                            ),
                            e('button', {
                                onClick: handleLogin,
                                className: `w-full px-4 py-3 ${darkMode ? 'bg-indigo-600 hover:bg-indigo-700' : 'bg-indigo-600 hover:bg-indigo-700'} text-white rounded-lg transition-colors font-medium`
                            }, 'Login')
                        )
                    )
                );
            }

            return e('div', { className: `flex flex-col h-screen ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-50 to-indigo-100'}` },
                // Header
                e('header', { className: `${darkMode ? 'bg-gray-800 border-b border-gray-700' : 'bg-white'} shadow-md p-4` },
                    e('div', { className: 'max-w-4xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4' },
                        e('div', { className: 'flex items-center gap-2' },
                            e(MessageCircleIcon, { className: `w-6 h-6 ${darkMode ? 'text-indigo-400' : 'text-indigo-600'}` }),
                            e('h1', { className: `text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}` }, 'Global Chatboard'),
                            e('span', { className: `text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} ml-2` }, `(${username})`)
                        ),
                        e('div', { className: 'flex gap-2' },
                            e('button', {
                                onClick: toggleDarkMode,
                                className: `px-3 py-1 ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'} rounded-lg transition-colors flex items-center gap-1`,
                                title: darkMode ? 'Light mode' : 'Dark mode'
                            },
                                darkMode ? e(SunIcon, { className: 'w-4 h-4 text-yellow-400' }) : e(MoonIcon, { className: 'w-4 h-4 text-gray-700' })
                            ),
                            e('button', {
                                onClick: handleLogout,
                                className: `px-4 py-1 ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-600 hover:bg-gray-700'} text-white rounded-lg transition-colors flex items-center gap-1`,
                                title: 'Logout'
                            },
                                e(LogOutIcon, { className: 'w-4 h-4' }),
                                e('span', { className: 'hidden sm:inline' }, 'Logout')
                            )
                        )
                    )
                ),

                // Main content
                e('main', { className: 'flex-1 overflow-hidden max-w-4xl w-full mx-auto p-4' },
                    e('div', { className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-lg h-full flex flex-col` },
                        // Messages area
                        e('div', { className: 'flex-1 overflow-y-auto p-4 space-y-3' },
                            messages.length === 0 
                                ? e('div', { className: `text-center ${darkMode ? 'text-gray-400' : 'text-gray-500'} mt-8` },
                                    e(MessageCircleIcon, { className: `w-16 h-16 mx-auto mb-4 ${darkMode ? 'text-gray-600' : 'text-gray-300'}` }),
                                    e('p', null, 'No messages yet. Be the first to say hello!')
                                )
                                : messages.map((msg) =>
                                    e('div', {
                                        key: msg.id,
                                        className: `flex flex-col ${msg.username === username ? 'items-end' : 'items-start'}`
                                    },
                                        e('div', {
                                            className: `max-w-xs md:max-w-md px-4 py-2 rounded-lg ${
                                                msg.username === username
                                                    ? darkMode ? 'bg-indigo-600 text-white' : 'bg-indigo-600 text-white'
                                                    : darkMode ? 'bg-gray-700 text-gray-100' : 'bg-gray-200 text-gray-800'
                                            }`
                                        },
                                            e('p', { className: 'font-semibold text-sm mb-1' }, msg.username),
                                            e('p', { className: 'break-words' }, msg.text)
                                        ),
                                        e('span', { className: `text-xs ${darkMode ? 'text-gray-500' : 'text-gray-500'} mt-1 px-2` },
                                            formatTime(msg.timestamp)
                                        )
                                    )
                                ),
                            e('div', { ref: messagesEndRef })
                        ),

                        // Error message
                        error && e('div', { className: `px-4 py-2 ${darkMode ? 'bg-red-900 border-t border-red-800 text-red-200' : 'bg-red-50 border-t border-red-200 text-red-700'} flex items-center gap-2` },
                            e(AlertCircleIcon, { className: 'w-4 h-4' }),
                            e('span', { className: 'text-sm' }, error)
                        ),

                        // Input area
                        e('div', { className: `p-4 border-t ${darkMode ? 'border-gray-700' : 'border-gray-200'}` },
                            e('div', { className: 'flex gap-2' },
                                e('input', {
                                    type: 'text',
                                    value: message,
                                    onChange: (ev) => setMessage(ev.target.value),
                                    onKeyDown: (ev) => ev.key === 'Enter' && handleMessageSubmit(),
                                    placeholder: 'Type your message...',
                                    className: `flex-1 px-4 py-2 border ${darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900'} rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`,
                                    maxLength: 500
                                }),
                                e('button', {
                                    onClick: handleMessageSubmit,
                                    disabled: !message.trim() || !username.trim(),
                                    className: `px-6 py-2 ${darkMode ? 'bg-indigo-600 hover:bg-indigo-700' : 'bg-indigo-600 hover:bg-indigo-700'} text-white rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2`,
                                },
                                    e(SendIcon, { className: 'w-4 h-4' }),
                                    'Send'
                                )
                            )
                        )
                    )
                ),

                // Footer
                e('footer', { className: `${darkMode ? 'bg-gray-800 border-t border-gray-700 text-gray-400' : 'bg-white border-t border-gray-200 text-gray-600'} p-3 text-center text-sm` },
                    'Messages are shared globally with all users â€¢ Please be respectful'
                )
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(e(GlobalChatboard));
    </script>
</body>
</html>
